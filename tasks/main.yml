- name: Install dependencies
  apt:
    name={{ item }}
    state=present
    update_cache=yes
    cache_valid_time=3600
  with_items:
    - supervisor
  sudo: yes

- name: Installing task {{ name }}
  template: src=task.conf.j2 dest={{ supervisor_config_dir }}/{{ name }}.conf
  sudo: yes

- name: Update supervisor
  command: "{{ supervisorctl_command }} update"
  sudo: yes

- name: Restart task {{ name }}
  command: "{{ supervisorctl_command }} restart {{ name }}:*"
  when: restart_task
  sudo: yes
